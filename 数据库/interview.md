1. mysql优化

	MYSQL优化主要分为以下四大方面：

	设计：存储引擎，字段类型，范式与逆范式

	功能：索引，缓存，分区分表。

	架构：主从复制，读写分离，负载均衡。

	合理SQL：测试，经验。

2. 找出两门以上成绩不及格的学生的学号

```
select number from sc where score < 60 grouby number having count(*) > 2 
```

3. 索引和primaryKey

	1、主键一定是唯一性索引，唯一性索引并不一定就是主键。

	2、一个表中可以有多个唯一性索引，但只能有一个主键。

	3、主键列不允许空值，而唯一性索引列允许空值。

4. count(*) 和 count(1)和count(列名)区别

	count(*) 和 count(1)和count(列名)区别
	执行效果上：
	count(*)包括了所有的列，相当于行数，在统计结果的时候，不会忽略列值为NULL
	count(1)包括了忽略所有列，用1代表代码行，在统计结果的时候，不会忽略列值为NULL
	count(列名)只包括列名那一列，在统计结果的时候，会忽略列值为空（这里的空不是只空字符串或者0，而是表示null）的计数，即某个字段值为NULL时，不统计
	执行效率上：
	列名为主键，count(列名)会比count(1)快
	列名不为主键，count(1)会比count(列名)快
	如果表多个列并且没有主键，则 count（1） 的执行效率优于 count（*）
	如果有主键，则 select count（主键）的执行效率是最优的
	如果表只有一个字段，则 select count（*）最优

5. mysql优化

MYSQL优化主要分为以下四大方面：

设计：存储引擎，字段类型，范式与逆范式

功能：索引，缓存，分区分表。

架构：主从复制，读写分离，负载均衡。

合理SQL：测试，经验。

一、存储引擎

1、InnoDB存储引擎介绍

Mysql版本>=5.5 默认的存储引擎，MySQL推荐使用的存储引擎。支持事务，行级锁定，外键约束。事务安全型存储引擎。更加注重数据的完整性和安全性。
总结：innodb擅长事务、数据的完整性及高并发处理，不擅长快速插入（插入前要排序，消耗时间）和检索。

2.MyISAM存储引擎介绍

MySQL<= 5.5 MySQL默认的存储引擎。
ISAM：Indexed Sequential Access Method(索引顺序存取方法)的缩写，是一种文件系统。

关于Innodb 和myisam的取舍：

Innodb ：数据完整性，并发性处理，擅长更新，删除。
myisam：高速查询及插入。擅长插入和查询。

二、字段类型选择

字段类型应该要满足需求，尽量要满足以下需求。
尽可能小（占用存储空间少）、尽可能定长（占用存储空间固定）、尽可能使用整数。

三、范式与逆范式

第一范式1NF，原子性
第二范式2NF，消除部分依赖
第三范式3NF，消除传递依赖

1、范式

（1）第一范式：具有原子性，确保每列保持原子性。
（2）第二范式：主键列与非主键列遵循完全函数依赖关系，确保表中的每列都和主键相关。
（3）第三范式：非主键列之间没有传递函数依赖关系索引，确保每列都和主键列直接相关,而不是间接相关。

2、逆范式

逆范式是指打破范式，通过增加冗余或重复的数据来提高数据库的性能。

四、索引

从索引的定义方式和用途中来看：主键索引，唯一索引，普通索引，全文索引。

这里主键索引和唯一索引的区别在于：主键索引不能为空值，唯一索引允许空值；主键索引在一张表内只能创建一个，唯一索引可以创建多个。主键索引肯定是唯一索引，但唯一索引不一定是主键索引。

索引原则

（1）列独立

如果需要某个字段上使用索引，则需要在字段参与的表达中，保证字段独立在一侧。

（2）左原则

Like：匹配模式必须要左边确定不能以通配符开头。

复合索引：一个索引关联多个字段，仅仅针对左边字段有效果。

（3）OR的使用

必须要保证 OR 两端的条件都存在可以用的索引，该查询才可以使用索引。

（4）MySQL智能选择

弃用索引的主要原因：

查询即使使用索引，会导致出现大量的随机IO，相对于从数据记录的第一条遍历到最后一条的顺序IO开销，还要大。

例：数据含有null

综上归纳：

a、不要过度索引。索引越多，占用空间越大，反而性能变慢；
b.只对WHERE子句中频繁使用的建立索引；
c.尽可能使用唯一索引，重复值越少，索引效果越强；
d.使用短索引，如果char(255)太大，应该给它指定一个前缀长度，大部分情况下前10位或20位值基本是唯一的，那么就不要对整个列进行索引；
e.充分利用左前缀，这是针对复合索引，因为WHERE语句如果有AND并列，只能识别一个索引(获取记录最少的那个)，索引需要使用复合索引，那么应该将WHERE最频繁的放置在左边。
f.索引存在，如果没有满足使用原则，也会导致索引无效

5.索引的使用场景

（1）索引检索：检索数据时使用索引。
（2）索引排序
（3）索引覆盖

6.前缀索引

7.全文索引

该类型的索引特殊在：关键字的创建上。是为了解决 like&lsquo;%keyword%&rsquo;这类查询的匹配问题。（mysql的全文索引几乎不用，因为它不支持中文，我们应该使用sphinx全文索引）。

五、查询缓存query_cache

六、分区分表

分区，partition，分区是将数据分段划分在多个位置存放，可以是同一块磁盘也可以在不同的机器。分区后，表面上还是一张表，但数据散列到多个位置了。app读写的时候操作的还是大表名字，db自动去组织分区的数据。

1.分区算法

MySQL提供4种分区算法：取余：Key，hash 条件：List，range 。

3.分表

分表是将一个大表按照一定的规则分解成多张具有独立存储空间的实体表，我们可以称为子表，每个表都对应三个文件，MYD数据文件，.MYI索引文件，.frm表结构文件。这些子表可以分布在同一块磁盘上，也可以在不同的机器上。app读写的时候根据事先定义好的规则得到对应的子表名，然后去操作它。分表技术是比较麻烦的，需要手动去创建子表，app服务端读写时候需要计算子表名。采用merge好一些，但也要创建子表和配置子表间的union关系。（需要手动分表）

分表是分区之前用的，MYSQL5.1后，就开始用分区代替分表了。分表很少用了。

（1）水平分表

创建结构相同的N个表；

（2）垂直分表

一张表中存在多个字段。这些字段可以分为常用字段和非常用字段，为了提高查表速度，我们可以把这两类字段分开来存储。主要目的，减少每条记录的长度。

七、服务器架构介绍

服务器架构，不仅仅是用一台MySQL

主从复制：

Mysql服务器内部支持复制功能，仅仅需要通过配置完成下面的拓扑结构。一主多从典型结果：主服务器负责写数据。从服务器负责读数据。复制功能mysql会自带。

读写分离，负载均衡：

php不再操作MYSQL数据库服务器，而是去操作读写分离、负载均衡服务器，只要服务器安装了mysql proxy或Ameoba软件就可以实现读写分离和负载均衡，读写分离是指该服务器会判断客户端的操作是读还是写，从而选择操作mysql主服务器还是从服务器。负载均衡算法是指，客户端读操作时，该服务器会根据取余算法去选择一台从服务器。

八、SQL优化

1.对于并发性的SQL

少用（不用）多表操作（子查询，联合查询），而是将复杂的SQL拆分多次执行。如果查询很原子（很小），会增加查询缓存的利用率。

2.分页

Limit 的使用，会大大提升无效数据的检索（被跳过），因为是先检索，检索会检索全部，再取得想要的。好的做法是使用条件等过滤方式，将检索到的数据尽可能精确定位到需要的数据上。

3.随机选一些数据，不要使用Order by Rand()
建议，通过mt_rand()，先确定的随机主键，再从数据表中获取数据。

6. 索引何时需要、何时不需要、何时失效


7. 乐观锁，悲观锁

悲观锁认为被它保护的数据是极其不安全的，每时每刻都有可能变动，一个事务拿到悲观锁后（可以理解为一个用户），其他任何事务都不能对该数据进行修改，只能等待锁被释放才可以执行。

乐观锁的“乐观情绪”体现在，它认为数据的变动不会太频繁。因此，它允许多个事务同时对数据进行变动。 但是，乐观不代表不负责，那么怎么去负责多个事务顺序对数据进行修改呢？乐观锁通常是通过在表中增加一个版本(version)或时间戳(timestamp)来实现

8. 数据库四种隔离状态

未提交读
提交读
可重复读
串行读

9. 数据库事务的四大特性

原子性
一致性
隔离性
持久性

https://blog.csdn.net/j1231230/article/details/104719632

https://blog.csdn.net/ps08160000/article/details/90142274

https://www.cnblogs.com/superchong/p/10847966.html

10. Redis雪崩、穿透和击穿

- <https://juejin.cn/post/6844903886113751053>
- <https://juejin.cn/post/7027440894378770439>

11. mysql索引分类

Primary Key（聚集索引）：InnoDB存储引擎的表会存在主键（唯一非null），如果建表的时候没有指定主键，则会使用第一非空的唯一索引作为聚集索引，否则InnoDB会自动帮你创建一个不可见的、长度为6字节的row_id用来作为聚集索引。

单列索引：单列索引即一个索引只包含单个列

组合索引：组合索引指在表的多个字段组合上创建的索引，只有在查询条件中使用了这些字段的左边字段时，索引才会被使用。使用组合索引时遵循最左前缀集合
- <https://segmentfault.com/a/1190000015416513>

Unique（唯一索引）：索引列的值必须唯一，但允许有空值。若是组合索引，则列值的组合必须唯一。主键索引是一种特殊的唯一索引，不允许有空值

Key（普通索引）：是MySQL中的基本索引类型，允许在定义索引的列中插入重复值和空值

FULLTEXT（全文索引）：
SPATIAL（空间索引）：

12. redis测试点

redis生效时数据读取是否正确

redis数据不存在，能否从mysql中读取正常展示并且在redis中正确设置

数据有更新时，redis是否能正常更新

不会重复设置redis某一数据

redis数据的缓存时间

超量淘汰机制

缓存雪崩，穿透，击穿
